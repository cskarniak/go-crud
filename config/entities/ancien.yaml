# config/entities/categories.yaml

entity:
  name: "categories"
  table: "categories"
  label: "Catégories"
  labelPlural: "Catégories"
  defaultPageSize: 10

fields:
  - name: "id"
    type: "uint"
    label: "id"
    readonly: true
    default: null
  - name: "libelle"
    type: "string"
    label: "Labellé"
    default: ""
  - name: "date_maj"
    type: "date"
    label:  "Date MAJ"
    displayFormat: "02/01/2006"
    required: true
  - name: "pod"
    type: "uint"
    label: "Pod"
    required: false
    default: null
  - name: "podvisu"
    type: "uint"
    label: "pod visu"
    required: False
    default: null
    readonly: false
  - name: "podvision"
    type: "text" # Ajout explicite du type 'text'
    label: "podvision"
    required: False
    default: null
    readonly: false

forms:
  - name: "categoriesList"
    type: "list"
    entity: "categories"
    config:
      maxHeight: "900px"
      pageSize: 10   
      defaultSortField: "id"
      defaultSortOrder: "asc"
      pageSizeOptions: [5, 10, 25, 50]
      columns: ["id", "libelle"]
      searchableFields: ["id", "libelle"]
      sortableFields: ["id", "libelle"]
      labels:
        title: "Liste des catégories"
      # Nouvelles propriétés pour la liste
      buttonFontSize: "0.75rem" # Taille de police par défaut pour les boutons de liste
      paginationButtonFontSize: "0.875rem" # Taille de police par défaut pour les boutons de pagination
      paginationTextFontSize: "0.875rem" # Taille de police par défaut pour le texte de pagination

  - name: "categoriesFiche"
    type: "fiche"
    entity: "categories"
    config:
      # Nouvelles propriétés pour la fiche
      tabInactiveBackgroundColor: "#e9ecef" # Couleur de fond par défaut des onglets inactifs
      tabActiveBackgroundColor: "#ffffff"   # Couleur de fond par défaut de l'onglet actif
      tabContentBackgroundColor: "#ffffff"  # Couleur de fond par défaut du contenu des onglets
      labelColumnWidth: "25%"               # Largeur par défaut de la colonne des libellés
      tabLabelFontSize: "0.85rem"              # Taille de police par défaut des libellés d'onglets
      buttonFontSize: "1rem"                # Taille de police par défaut des boutons généraux de fiche
      formActionButtonsFontSize: "0.75rem"     # Taille de police par défaut des boutons d'action (Enregistrer/Annuler)
      formContentMaxHeightAdjustment: "200px" # Ajusté à une valeur plus réaliste
      groups:
        - name: "Infos principales"
          fields: 
          - name: "id"
          - name: "libelle"
          - name: "date_maj"
          - name: "pod"
            type: combo_base  
            sql: |
              SELECT id,libelle
              FROM categories
              WHERE 1 = 1
              ORDER BY libelle
            keyField: id
            displayFields:
                - id
                - libelle
            separator: " - "
          - name: "podvisu"
            type: vision
            cssClass: "field-podvisu"
            sql: |
              SELECT id,libelle
              FROM categories
              WHERE 1 = 1
              ORDER BY libelle
            keyField: id
            displayFields:
              - id
              - libelle
            returnField: id                # colonne qu’on renvoie dans client_id
            modalTitle: "Sélectionner une catégorie"

      labels:
        titleCreate: "Création d’une catégorie"
        titleUpdate: "Édition d’une catégorie"
        submitCreate: "Créer"
        submitUpdate: "Enregistrer"
        cancel: "Annuler"

  # --- FORMULAIRE VISION AVEC PARAMÈTRE DYNAMIQUE ---
  - name: "subCategoriesVisu"
    type: "vision"
    config:
      sql: |
        SELECT id, libelle, date_maj
        FROM categories
        WHERE pod = :parent_id
      params:
        - name: "parent_id"
          source: "context"
          contextField: "podvision"
      actions:
        allowCreate: false
        allowUpdate: true
        allowDelete: false
        allowSelectable: true # V29 - On désactive le mode sélection pour ce formulaire
      columns: ["id", "libelle", "date_maj"]
      labels:
        title: "Sous-catégories (Consultation)"
      pageSize: 5
      defaultSortField: "libelle"
      defaultSortOrder: "asc"
