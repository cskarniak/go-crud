<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>{{ .VisionConfig.Title }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/assets/css/popup/popup.css" rel="stylesheet">
</head>
<body style="background-color: {{ .VisionConfig.PageBackgroundColor }};">

  <div class="container-fluid mt-3">
    <div class="card" style="background-color: {{ .VisionConfig.FormBackgroundColor }};">
      <div class="card-header">
        {{ .VisionConfig.Title }}
      </div>
      <div class="card-body">
        <table class="table table-hover">
          <thead>
            <tr>
              {{ range .Columns }}
              <th>{{ . }}</th>
              {{ end }}
            </tr>
          </thead>
          <tbody>
            {{ range .Data }}
            <tr onclick="selectAndClose(this)" style="cursor: pointer;"
                data-return-value="{{ index . $.ReturnField }}"
                data-display-value="{{ index . $.ReturnFieldDisplay }}">
              {{ range $.Columns }}
              <td>{{ index $.DataRow . }}</td>
              {{ end }}
            </tr>
            {{ end }}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    function selectAndClose(row) {
      const returnValue = row.dataset.returnValue;
      const displayValue = row.dataset.displayValue;
      const returnTo = "{{ .ReturnTo }}";

      if (window.opener && !window.opener.closed) {
        window.opener.updateParentField(returnTo, returnValue, displayValue);
        window.close();
      } else {
        alert("Fenêtre parente non trouvée.");
      }
    }
  </script>

</body>
</html>
