<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>
    {{ if eq .Mode "new" }}
      {{ index .Entity.Fiche.Labels "titleCreate" }}
    {{ else }}
      {{ index .Entity.Fiche.Labels "titleUpdate" }}
    {{ end }}
  </title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet">
  <link href="/assets/css/form.css" rel="stylesheet">
</head>
<body>
  <div class="card form-card shadow-sm mt-4">

    <div class="card-header bg-primary text-white py-2">
      <h5 class="mb-0 text-center">
        {{ if eq .Mode "new" }}
          {{ index .Entity.Fiche.Labels "titleCreate" }}
        {{ else }}
          {{ index .Entity.Fiche.Labels "titleUpdate" }}
        {{ end }}
      </h5>
    </div>

    <div class="card-body">
      <form
        method="post"
        action="{{ if eq .Mode "new" -}}
                  /{{ .Entity.Fiche.Name }}?page={{ .Page }}&pageSize={{ .PageSize }}&sort={{ .SortField }}&order={{ .SortOrder }}
                {{- else -}}
                  /{{ .Entity.Fiche.Name }}/update/{{ index .DataRow "id" }}?page={{ .Page }}&pageSize={{ .PageSize }}&sort={{ .SortField }}&order={{ .SortOrder }}
                {{- end }}">

        {{/* Boucle sur vos groupes et leurs champs */}}
        {{ range .Entity.Fiche.Groups }}
          <fieldset class="mb-4">
            <legend>{{ .Name }}</legend>

            {{ range .Fields }}
              {{ $fd := . }}
              <div class="row mb-3 align-items-center">
                <label for="{{ $fd.Name }}" class="col-sm-3 col-form-label fw-bold">
                  {{ $fd.Name }}
                </label>
                <div class="col-sm-9">

                  {{ if eq $fd.Type "combo_base" }}
                    <select
                      id="{{ $fd.Name }}"
                      name="{{ $fd.Name }}"
                      class="form-select{{ if index $.Errors $fd.Name }} is-invalid{{ end }}"
                      {{ with index $.Code.FrontValidations $fd.Name }}
                        {{ if .Required }} required{{ end }}
                      {{ end }}>

                      {{ range $opt := index $.ComboData $fd.Name }}
                        <option
                          value="{{ $opt.Value }}"
                          {{ if eq (printf "%v" $opt.Value) (printf "%v" (index $.DataRow $fd.Name)) }}
                            selected
                          {{ end }}>
                          {{ $opt.Label }}
                        </option>
                      {{ end }}
                    </select>

                  {{ else }}
                    <input
                      type="text"
                      id="{{ $fd.Name }}"
                      name="{{ $fd.Name }}"
                      class="form-control{{ if index $.Errors $fd.Name }} is-invalid{{ end }}"
                      value="{{ index $.DataRow $fd.Name }}"
                      {{ if $fd.ComboConfig }}{{ end }}  {{/* no-op */}}
                      {{ with index $.Code.FrontValidations $fd.Name }}
                        {{ if .Required }} required{{ end }}
                        {{ if .Pattern }} pattern="{{ .Pattern }}" title="{{ .Title }}"{{ end }}
                      {{ end }}>
                  {{ end }}

                  {{/* Affichage inline des erreurs back-end */}}
                  {{ with index $.Errors $fd.Name }}
                    <div class="invalid-feedback">
                      {{ . }}
                    </div>
                  {{ end }}

                </div>
              </div>
            {{ end }}
          </fieldset>
        {{ end }}

        <div class="mt-4 text-end">
          <button type="submit" class="btn btn-success">
            {{ if eq .Mode "new" }}
              {{ index .Entity.Fiche.Labels "submitCreate" }}
            {{ else }}
              {{ index .Entity.Fiche.Labels "submitUpdate" }}
            {{ end }}
          </button>
          <a
            href="/{{ .Entity.List.Name }}?page={{ .Page }}&pageSize={{ .PageSize }}&sort={{ .SortField }}&order={{ .SortOrder }}"
            class="btn btn-secondary ms-2">
            {{ index .Entity.Fiche.Labels "cancel" }}
          </a>
        </div>

      </form>
    </div>
  </div>
</body>
</html>
